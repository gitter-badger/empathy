
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The MVC &mdash; Empathy 0.9.5.2 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Empathy 0.9.5.2 documentation" href="index.html" />
    <link rel="prev" title="Getting Started" href="gettingstarted.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Empathy 0.9.5.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-mvc">
<h1>The MVC<a class="headerlink" href="#the-mvc" title="Permalink to this headline">¶</a></h1>
<p>You may or may not be familiar with MVC architectures but after this section
it should all be pretty clear to you and hopefully you will feel confident creating
your own model, controller and view code within Empathy.</p>
<div class="section" id="models">
<h2>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s jump straight into the deep end then and create a model.  The first you&#8217;ll need
to do is create the directory where model files live which is called &#8216;storage&#8217;.  (By the way
the convention of having directories labelled &#8216;application&#8217;, &#8216;storage&#8217; and &#8216;presentation&#8217;
is a convention within Empathy that goes back to at least 2007.):</p>
<p>Anyway so within the root directory of your app:</p>
<div class="highlight-python"><pre>$ mkdir ./storage</pre>
</div>
<p>Inside create a file called Hello.php with the following contents:</p>
<div class="highlight-python"><pre>&lt;?php

namespace Empathy\MVC\Model;

class Hello
{
    private $_name;

    public function __construct($name)
    {
        $this-&gt;name = $name;
        if($this-&gt;name == 'Laura') {
            $this-&gt;name = 'bitch';
        }
    }
    private function _getName()
    {
        return $this-&gt;name;
    }

    public function sayHi()
    {
        echo 'Hello, '.$this-&gt;_getName();
    }
}</pre>
</div>
<p>Let&#8217;s leave testing this new model for now.</p>
</div>
<div class="section" id="controllers">
<h2>Controllers<a class="headerlink" href="#controllers" title="Permalink to this headline">¶</a></h2>
<p>Controllers live in direcorties under &#8216;application&#8217; beneath the root folder. These sub-folders are knows as modules and each module needs to have a class of the same neame beneath it.  To create a new module create the directory &#8216;front&#8217; and inside this directory the file &#8216;front.php&#8217; with the following code:</p>
<div class="highlight-python"><pre>&lt;?php

namespace Empathy\MVC\Controller;

class front extends CustomController
{
        public function default_event()
        {
                // do some stuff...
        }
}</pre>
</div>
<p>We&#8217;re going to create a perfectly valid controller because we&#8217;re going to get this controller to do very little. This is one of the core concepts of Empathy. ALWAYS use &#8220;thin controllers&#8221; instead of &#8220;fat controllers&#8221;.  This
means that the functions (or &#8216;actions&#8217;) inside controller classes should alwsy be only a few lines.  So inside
the default_event function we&#8217;re going to create an instance of the Hello model and pass it to the view.  This is done like this:</p>
<div class="highlight-python"><pre>public function default_event()
{
        $h = \Empathy\MVC\Model::load('Hello', null, array('Mike'));
        $this-&gt;assign('hello', $h);
}</pre>
</div>
<p>The key line in this code is the call to &#8216;Model::load&#8217;.  The first parameter here is the name of our model class, which resides within the storage directory.  The second argument, which has been set to null, is where an ID may be specified for fetching a specific record from the database with the corresponding ID.  The last argument is an array of parameters that we want to send
to model class as it is instantiatetd.  (In the section after this one we will be looking at more advanced uses of the model
and the native MySQL abstraction functionality that relies on Entity model classes. -&gt;</p>
<p>[to do add a description about the nameing conventions of modules, classes and actions].</p>
</div>
<div class="section" id="views">
<h2>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p>Views from the perspective of a web application are simply the rendered templates that store HTML code.  To create a new view we need to create a file called &#8216;front.tpl&#8217; inside the directory labelled &#8216;presentation&#8217;.  By default, when Empathy displays a view it will look for a template file that has the same name of the current class.  In this case the class is the same name as the module. (The directory the class is within).  If you preferred to have
Empathy always look for a tempate file that has the same name as the current module you can change this setting by
adding an entry to the global config file:</p>
<div class="highlight-python"><pre>tpl_by_class: false</pre>
</div>
<p>If this is set to true then the default behaviour is that it will load a template that has the same name as the class. For example we might have another controller inside the &#8216;front&#8217; module called &#8216;other.php&#8217;.  The view empathy will look for to load will be called &#8216;other.tpl&#8217;.</p>
<p>To choose to load a custom named template it is done explicitly.  This is done by using the setTempalte function (which belongs to controller classes). e.g inside our &#8216;default_event&#8217; action we could have this code:</p>
<div class="highlight-python"><pre>$h = \Empathy\MVC\Model::load('Hello', null, array('Mike'));
$this-&gt;assign('hello', $h);
$this-&gt;setTempalte('my_other_template.tpl');</pre>
</div>
<p>If you expect to be using a custom named template lots of times within the same controller then this is recmmended solution where the template is assigned in the constructor.  If an action needs to use something different you can
always call setTemplate again to override the previous selection:</p>
<div class="highlight-python"><pre>&lt;?php

namespace Empathy\MVC\Controller;

class my_class
{
        public function __construct($boot)
        {
                parent::__construct($boot);
                $this-&gt;setTempate('custom.tpl');
        }


        public function default_event()
        {
                // will attempt to render the 'custom.tpl' template
        }
}</pre>
</div>
<p>What if you don&#8217;t want to render a view, you might be wondering.  In some rare cases where this is desired
it can be achieved by simply adding the following
line at the end of your action:</p>
<div class="highlight-python"><pre>return false; // don't attempt to render anything</pre>
</div>
<p>In the case of our app though we want to do something with the &#8216;Hello&#8217; model that is being passed to the view
by the controller.  Let&#8217;s try calling the &#8216;sayHello&#8217; method which is native to our model object.  Inside
our &#8216;front.tpl&#8217; template file:</p>
<div class="highlight-python"><pre>{$hello-&gt;sayHello()}</pre>
</div>
<p>For more information on what you can do with Smarty templates see <a class="reference external" href="http://smartypants.com">http://smartypants.com</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The MVC</a><ul>
<li><a class="reference internal" href="#models">Models</a></li>
<li><a class="reference internal" href="#controllers">Controllers</a></li>
<li><a class="reference internal" href="#views">Views</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="gettingstarted.html"
                        title="previous chapter">Getting Started</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/themvc.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="gettingstarted.html" title="Getting Started"
             >previous</a> |</li>
        <li><a href="index.html">Empathy 0.9.5.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Mike Whiting.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>